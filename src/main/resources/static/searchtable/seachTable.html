<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查询所有表</title>
    <script src="../jquery.min.js"></script>
    <script src="seachTable.js"></script>
</head>
<body>

<textarea id="replaceStr" rows="10" cols="200">
    /*#mycat:sql=select 1 from bill_shop_balance where sharding_flag='U010101_Z' */
/*#mycat:sql=select 1 from bill_shop_balance where sharding_flag= 'U010101_Z'*/
SELECT B.*,bsba.headless_order_bill_no,bsba.customs_trade_name AS customsTradeName,bsba.customs_standards AS customsStandards,bsba.customs_type AS customsType,bsba.wholesale_declara_no AS wholesaleDeclaraNo,B.factory_price*B.send_qty AS factoryForehead,CASE WHEN bsba.wholesale_declara_no !='' OR bsba.wholesale_declara_no !=NULL THEN B.send_amount-B.other_deduct_cost-bsba.customs_deduct ELSE B.send_amount-B.other_deduct_cost END AS realBillingAmount,ere.conversion_factor AS chinaBankTagRate,ere.hrf_exchange_rate AS hrfExchangeRate,ROUND(B.cost/(CASE WHEN ere.hrf_exchange_rate=0 THEN 1 ELSE IFNULL(ere.hrf_exchange_rate,1) END),4) AS dollarsUnitPrice,ROUND(IFNULL(B.cost/(CASE WHEN ere.hrf_exchange_rate=0 THEN 1 ELSE IFNULL(ere.hrf_exchange_rate,1) END),0)*B.send_qty,2) AS dollarsPrice,bsba.customs_date AS customsDate,bsba.customs_deduct AS customsDeduct FROM (
SELECT B.id,B.bill_no,B.bill_type,B.original_bill_no,B.ref_bill_no,B.return_no,B.ref_bill_type,B.STATUS,B.buyer_no,B.buyer_name,c.full_name buyer_full_name,c.short_name buyer_short_name,B.saler_no,B.saler_name,CASE B.bill_type WHEN 1304 THEN B.receive_date WHEN 1372 THEN B.receive_date ELSE B.send_date END send_date,B.receive_date,B.send_store_no,B.send_store_name,B.receive_store_no,B.receive_store_name,B.sku_id,B.sku_no,B.supplier_no,B.item_no,B.item_code,B.item_name,B.brand_no,B.brand_name,B.brand_unit_no,B.brand_unit_name,B.category_no,B.category_name,B.cost,B.bill_cost,B.actual_cost,B.other_deduct_cost,B.headquarter_cost,B.region_cost,B.unit_cost,B.tax_rate,B.exclusive_cost,(CASE B.bill_type WHEN 1304 THEN B.receive_qty WHEN 1372 THEN B.receive_qty ELSE B.send_qty END) send_qty,B.order_no,B.balance_no,B.is_split,B.supplier_name,B.order_unit_name,B.organ_no,B.organ_name,B.zone_name,B.order_unit_name_from,B.organ_no_from,B.organ_name_from,CASE WHEN B.biz_type=60 AND B.supplier_no='Z999' THEN 60 WHEN B.biz_type=60 AND B.supplier_no !='Z999' THEN 61 ELSE B.biz_type END biz_type,B.zone_name_from,B.is_bill_invoice,B.bill_rebate_amount,B.bill_rebate_discount,B.unfrozen_date,B.receiving_flag,CASE WHEN B.receiving_flag=1 THEN '已收货' ELSE '未收货' END receivingFlagName,B.claim_no,IFNULL(B.tag_price,0) tag_price,IFNULL(B.receive_qty,0) receive_qty,IFNULL(B.send_qty,0)-IFNULL(B.receive_qty,0) difference_qty,IFNULL(B.cost*(CASE B.bill_type WHEN 1304 THEN B.receive_qty WHEN 1372 THEN B.receive_qty ELSE B.send_qty END),0) send_amount,IFNULL(B.cost*B.receive_qty,0) receive_amount,IFNULL(B.cost*(IFNULL(B.send_qty,0)-IFNULL(B.receive_qty,0)),0) difference_amount,B.remark,C1.category_no one_level_category_no,C1.NAME one_level_category_name,C2.category_no two_level_category_no,C2.NAME two_level_category_name,t2.NAME gender_name,t3.NAME years,t4.NAME season,SG.supplier_group_name,I.main_color,(
SELECT RIGHT (pr.settlement_number,2) FROM pay_relationship pr WHERE pr.business_bill_no=B.original_bill_no) AS channel_two,IF (BB.invoice_apply_no IS NULL OR BB.invoice_apply_no='','未开票','已开票') invoice_apply_no,IFNULL(PP.purchase_price,0) purchase_price,IFNULL(PP.material_price,0) material_price,IFNULL(PP.factory_price,0) factory_price,IFNULL(PP.purchase_price,0)*IF (B.bill_type=1304,IFNULL(B.receive_qty,0),IFNULL(B.send_qty,0)) purchase_amount,IFNULL(hcw.headquarter_cost,0)*IFNULL(send_qty,0) AS headquarter_amount,ROUND(B.cost/B.tag_price,4) discount_str FROM bill_sale_balance B INNER JOIN category C1 ON LEFT (B.`category_no`,2)=C1.`category_no` INNER JOIN category C2 ON LEFT (B.`category_no`,4)=C2.`category_no` LEFT JOIN lookup_entry t2 ON B.gender=t2.CODE AND t2.lookup_id=7 LEFT JOIN lookup_entry t3 ON B.years=t3.CODE AND t3.lookup_id=5 LEFT JOIN lookup_entry t4 ON B.season=t4.CODE AND t4.lookup_id=72 LEFT JOIN customer c ON c.customer_no=B.buyer_no LEFT JOIN (
SELECT bill_no,invoice_apply_no FROM bill_balance) BB ON BB.bill_no=B.balance_no LEFT JOIN (
SELECT t0.group_no supplier_group_no,t0.group_name supplier_group_name,t1.supplier_no supplier_no_sg FROM supplier_group t0,supplier_group_rel t1 WHERE t0.group_no=t1.group_no) SG ON B.supplier_no=SG.supplier_no_sg INNER JOIN item I ON B.item_no=I.item_no AND B.brand_no=I.brand_no LEFT JOIN headquarter_cost_weighting hcw ON B.item_no=hcw.item_no AND B.saler_no=hcw.company_no AND DATE_FORMAT(B.send_date,'%Y-%m')=DATE_FORMAT(hcw.effective_time,'%Y-%m') LEFT JOIN purchase_price PP ON PP.item_no=B.item_no AND PP.supplier_no=B.supplier_no AND PP.effective_date<=B.send_date AND pp.STATUS=100 WHERE 1=1 AND 1=1 AND 1=1 AND SALER_NO IN ('C0001','C0002','C0003','C0004','C0005','D0001','D0002','D0003','E0001','E0002','F0001','F0002','F0003','G0001','G0002','H0001','H0002','H0003','I0001','I0002','K0001','K0002','L0001','L0002','M0001','M0002','M0003','N0001','N0002','Z0005','Z0006','M0004','M0005','H0004','G0003','D0004','D0005','D0006','Z0009','K0003','Q0001','Z0010','R1000','Z0013','Z0014','Z0015','Z0016','Z0017','Z0018','Z0019','Z0020','Z0021','Z0023','Z0022','G0004','K9005','I9006','D0007','E0003','Z0028','Z1001','I5678','C2334','ga001','CIUU3','CWR11','Z1190','C2345','Z1120','LY009','C3334','w2212','Z1002','D3445','C2344','D9939','C1234','C3442','DC342','D3221','HN212','HN222','HB001','DS001','DB001','sd737','K8009','G01WE','34444','11111','D1124','K2320','AS124','HN234','K2321','D1324','Z2033','Z2034','D2101','D9201','D3334','D9298','D3336','CS009','CS111','CS888','CNJA0','JSGA9','C8833','CS000','B1GSG','K0004','K0008','FS001','Y0001','LH001','Z0091','KK001','LHXY1','Z1003','NCJ01','MAPST','1CS73','3CS73','1CS15','777NC','TX001','10001','Z3007','XXX01','UPMCO','JTS00','JJKKL','HJ001','Z0066','DJSJD','ewqrt','JS118','HXY01','JSGS0','OSI00','K7777') AND bill_type=1335 AND biz_type IN (21,29,22,30,43,48,47,46,72,73,80) AND B.send_date>='2022-03-26' AND B.send_date<='2022-04-25' ORDER BY B.id,pp.effective_date DESC) B LEFT JOIN bill_sale_balance_additional bsba ON bsba.original_bill_no=B.original_bill_no AND bsba.item_code=B.item_code AND bsba.item_no=B.item_no LEFT JOIN exchange_rate_setup ere ON ere.company_no=B.saler_no AND ere.STATUS=1 AND ere.effective_date<=B.send_date AND source_currency='003' AND target_currency='001' AND ere.effective_date=(
SELECT MAX(effective_date) FROM exchange_rate_setup WHERE B.send_date>=effective_date AND STATUS=1 AND company_no=B.saler_no AND source_currency='003' AND target_currency='001') GROUP BY B.id LIMIT 0,10;
</textarea>
<input type="button" value="获取表" onclick="clickTable()"/> </br>
所有表 (<span id="tableAlls">0</span> ):</br>
<textarea id="sqlTableCount" rows="5" cols="200">
</textarea>
去重后的表(<span id="goToHeavyTables">0</span> ):</br>
<textarea id="goToHeavyTable" rows="10" cols="200">
</textarea>
</body>
</html>
